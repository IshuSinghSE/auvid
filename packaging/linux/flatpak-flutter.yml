app-id: io.github.IshuSinghSE.auvid
runtime: org.freedesktop.Platform
runtime-version: '25.08'
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.llvm20
command: auvid
finish-args:
  - --share=network
  - --share=ipc
  - --socket=fallback-x11
  - --socket=wayland
  - --device=dri
  - --filesystem=xdg-download
  - --talk-name=org.freedesktop.Notifications

modules:
  - name: python3-yt-dlp
    buildsystem: simple
    build-commands:
      - pip3 install --verbose --exists-action=i --no-index --find-links="file://${PWD}" --prefix=${FLATPAK_DEST} "yt-dlp" --no-build-isolation
    sources:
      - type: file
        url: https://files.pythonhosted.org/packages/6e/2f/98c3596ad923f8efd32c90dca62e241e8ad9efcebf20831173c357042ba0/yt_dlp-2025.12.8-py3-none-any.whl
        sha256: 36e2584342e409cfbfa0b5e61448a1c5189e345cf4564294456ee509e7d3e065

  - name: ffmpeg
    buildsystem: simple
    build-commands:
      - install -Dm755 $(find . -name ffmpeg -type f -executable | head -n1) /app/bin/ffmpeg
      - install -Dm755 $(find . -name ffprobe -type f -executable | head -n1) /app/bin/ffprobe
    sources:
      - type: archive
        url: https://johnvansickle.com/ffmpeg/releases/ffmpeg-release-amd64-static.tar.xz
        sha256: abda8d77ce8309141f83ab8edf0596834087c52467f6badf376a6a2a4c87cf67
        strip-components: 1

  - name: auvid
    buildsystem: simple
    build-options:
      arch:
        x86_64:
          env:
            BUNDLE_PATH: build/linux/x64/release/bundle
        aarch64:
          env:
            BUNDLE_PATH: build/linux/arm64/release/bundle
      append-path: /usr/lib/sdk/llvm20/bin:/var/lib/flutter/bin
      prepend-ld-library-path: /usr/lib/sdk/llvm20/lib
      env:
        PUB_CACHE: /run/build/auvid/.pub-cache
    build-commands:
      - flutter config --no-analytics
      - flutter build linux --release --no-pub
      - install -D $BUNDLE_PATH/auvid -t /app/bin/
      - cp -r $BUNDLE_PATH/lib /app/bin/lib
      - cp -r $BUNDLE_PATH/data /app/bin/data
      - install -Dm755 /app/bin/yt-dlp /app/bin/yt-dlp_linux
      - install -Dm644 linux/runner/resources/app_icon.png /app/share/icons/hicolor/512x512/apps/${FLATPAK_ID}.png
      - install -Dm644 packaging/linux/${FLATPAK_ID}.desktop /app/share/applications/${FLATPAK_ID}.desktop
      - install -Dm644 packaging/linux/${FLATPAK_ID}.metainfo.xml /app/share/metainfo/${FLATPAK_ID}.metainfo.xml
    sources:
      - type: git
        url: https://github.com/flutter/flutter.git
        tag: 3.38.5
        dest: flutter

      - type: git
        url: https://github.com/IshuSinghSE/auvid.git
        commit : af20304901063360fabd8ad528304f40c2e57c4c
